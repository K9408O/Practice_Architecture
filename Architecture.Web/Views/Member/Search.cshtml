@model Architecture.Common.DTO.SearchDto

<h2>會員查詢</h2>

<form id="searchForm">
    <!-- 查詢全部會員按鈕 -->
    <button id="btnLoadAll" class="btn btn-primary mt-3">查詢全部會員</button>

    <div>
        <label>手機：</label>
        <input type="text" id="Phone" name="Phone" maxlength="10" />
    </div>
    <button type="submit" class="btn btn-primary">查詢</button>

</form>

<div id="searchResult" class="mt-3"></div>

<table class="table table-bordered table-hover mt-3">
    <thead>
        <tr>
            <th>姓名</th>
            <th>手機</th>
            <th>市話</th>
            <th>性別</th>
            <th>生日</th>
        </tr>
    </thead>
    <tbody id="allMembersBody">
        <!-- 這裡放動態生成的會員資料 -->
    </tbody>
</table>

@section scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script>
(function() {
    const apiBase = 'https://localhost:44362'; // 改成你的 API URL

    $('#searchForm').on('submit', function (e) {
        e.preventDefault();
        const phone = $('#Phone').val().trim();
        console.log("送出的 Phone：", phone);
        $.ajax({
            url: `${apiBase}/api/member/search`,
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ phone: phone }),
            success: function (member) {
                console.log("✅ 接收到回傳資料", member);
                if (!member) {
                    $('#searchResult').html('<div>查無此會員</div>').css('color', 'red');
                    return;
                }

                const birthdayText = member.birthday ? member.birthday.split('T')[0] : '無資料';

                $('#searchResult').html(`
                    <div>姓名：${member.Name}</div>
                    <div>手機：${member.Phone}</div>
                    <div>市話：${member.Tel || ''}</div>
                    <div>性別：${member.Gender}</div>
                    <div>生日：${member.Birthday ? member.Birthday.split('T')[0] : '無資料'}</div>
                `).css('color', 'black');
            }
        });
    });
        })();
        //搜尋全部
        $(function () {
            $('#btnLoadAll').click(function () {
                $.ajax({
                    url: 'https://localhost:44362/api/member/all', // ✅ API 地址
                    type: 'GET',
                    success: function (members) {
                        var rows = '';
                        if (members.length === 0) {
                            rows = '<tr><td colspan="5" class="text-center">目前沒有資料</td></tr>';
                        } else {
                            members.forEach(function (m) {
                                rows += `
                                <tr>
                                    <td>${m.Name}</td>
                                    <td>${m.Phone}</td>
                                    <td>${m.Tel || ''}</td>
                                    <td>${m.Gender}</td>
                                    <td>${m.Birthday ? m.Birthday.substring(0, 10) : ''}</td>
                                </tr>`;
                            });
                        }
                        $('#allMembersBody').html(rows);
                    },
                    error: function () {
                        alert('載入失敗！');
                    }
                });
            });
        });
    </script>
}
